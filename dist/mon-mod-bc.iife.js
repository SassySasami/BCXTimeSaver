!function(){"use strict";function t(t,e=window){for(const n of function(t=window){const e=[],n=[t];for(;n.length;){const t=n.pop();e.push(t);const r=t.frames;for(let e=0;e<r.length;e++){const o=r[e];if(o)try{o.location&&t.location&&o.location.origin===t.location.origin&&n.push(o)}catch{}}}return e}(e))try{if(t(n))return n}catch{}}function e(t){const e=t.BCX;if(!e)return;return"function"==typeof e.getModApi?e.getModApi("BCXTimeSaver"):e.api}function n(n=window){const r=t(t=>!!e(t),n);return r?e(r):void 0}function r(t,e,n){const r=document.createDocumentFragment();if(t.innerHTML="",!n.length){const e=document.createElement("div");return e.textContent="Aucune règle détectée. Clique sur ↻ pour réessayer.",void t.appendChild(e)}for(const t of n){const n=e.getRuleState(t),s=document.createElement("div");s.style.cssText=`\n      display:flex; gap:8px; align-items:center; margin:4px 0; padding:4px 6px; border-radius:6px;\n      ${n?.isEnforced?"background:rgba(46,160,67,.25); outline:1px solid rgba(46,160,67,.6);":""}\n    `;const i=document.createElement("code");i.textContent=t,i.style.cssText=`\n      background:rgba(0,0,0,.3); padding:2px 4px; border-radius:4px;\n      ${n?.isEnforced?"border:1px solid rgba(46,160,67,.6);":""}\n    `;const a=document.createElement("div");a.style.cssText="margin-left:auto; display:flex; gap:6px;";const d=o("Enforced","#2ea043",n?.isEnforced),c=o("In effect","#8b949e",n?.inEffect),l=o("Logged","#c69026",n?.isLogged);a.appendChild(d),a.appendChild(c),a.appendChild(l),s.appendChild(i),s.appendChild(a),r.appendChild(s)}t.appendChild(r)}function o(t,e,n){const r=document.createElement("span");return r.textContent=t,r.style.cssText=`\n    font-size:12px; padding:1px 6px; border-radius:999px;\n    border:1px solid ${e}; color:${n?"#fff":e};\n    background:${n?e:"transparent"};\n    opacity:${n?"1":".7"};\n  `,r}async function s(t){try{if("function"==typeof t.listRules){const e=await Promise.resolve(t.listRules());if(Array.isArray(e)&&e.every(t=>"string"==typeof t))return i(e)}}catch{}if("function"==typeof t.sendQuery){const e=[{type:"rules:listAll",data:{}},{type:"rules:list",data:{}},{type:"bcx:rules/list",data:{}},{type:"bcx:rules/all",data:{}}];for(const n of e)try{const e=await t.sendQuery(n.type,n.data,"Player",5e3);if(Array.isArray(e)&&e.every(t=>"string"==typeof t))return i(e);if(e&&Array.isArray(e.rules)&&e.rules.every(t=>"string"==typeof t))return i(e.rules);if(e&&Array.isArray(e.ids)&&e.ids.every(t=>"string"==typeof t))return i(e.ids)}catch{}}try{const t=window,e=t?.BCX?.api?.Rules,n=function(t){const e=[];if(!t)return e;if(Array.isArray(t))for(const n of t)"string"==typeof n&&e.push(n);else if("object"==typeof t){const n=["ids","all","list","rules"];for(const r of n){const n=t[r];Array.isArray(n)&&n.every(t=>"string"==typeof t)&&e.push(...n)}}return e}(e);if(n.length)return i(n)}catch{}return[]}function i(t){return Array.from(new Set(t))}async function a(){const t=function(){const t=document.createElement("div");t.style.cssText="\n    position: fixed; right: 16px; bottom: 16px; z-index: 999999;\n    background: rgba(0,0,0,.8); color: #fff; padding: 10px; border-radius: 8px;\n    font: 13px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;\n    width: 360px; box-shadow: 0 4px 24px rgba(0,0,0,.5);\n  ";const e=document.createElement("div");e.textContent="BCX TimeSaver — Règles",e.style.cssText="font-weight: 600; margin-bottom: 8px;";const n=document.createElement("div");n.style.cssText="display:flex; gap:6px; margin-bottom:6px;";const r=document.createElement("input");r.placeholder="MemberNumber (vide = Player)",r.style.cssText="\n    flex:1 1 auto; padding:4px 6px; border-radius:4px;\n    border:1px solid #444; background:#111; color:#fff;\n  ";const o=document.createElement("button");o.textContent="Afficher",o.style.cssText="\n    flex:0 0 auto; padding:4px 8px; border-radius:4px;\n    border:1px solid #666; background:#222; color:#fff; cursor:pointer;\n  ";const s=document.createElement("button");s.textContent="↻",s.title="Rafraîchir la liste des règles",s.style.cssText="\n    flex:0 0 auto; padding:4px 8px; border-radius:4px;\n    border:1px solid #666; background:#222; color:#fff; cursor:pointer;\n  ";const i=document.createElement("div");i.textContent="En attente de BCX…",i.style.cssText="opacity:.85; margin-bottom:6px;";const a=document.createElement("div");a.innerHTML='\n    <span style="display:inline-block;width:10px;height:10px;background:#2ea043;border-radius:2px;margin-right:4px;vertical-align:middle;"></span>\n    Enforced\n    <span style="display:inline-block;width:10px;height:10px;background:#8b949e;border-radius:2px;margin:0 4px 0 12px;vertical-align:middle;"></span>\n    In effect\n    <span style="display:inline-block;width:10px;height:10px;background:#c69026;border-radius:2px;margin:0 4px 0 12px;vertical-align:middle;"></span>\n    Logged\n  ',a.style.cssText="opacity:.85; margin-bottom:6px;";const d=document.createElement("div");return d.style.cssText="\n    max-height: 280px; overflow:auto; background: rgba(255,255,255,.06);\n    padding:6px; border-radius:6px;\n  ",n.appendChild(r),n.appendChild(o),n.appendChild(s),t.appendChild(e),t.appendChild(n),t.appendChild(i),t.appendChild(a),t.appendChild(d),document.body.appendChild(t),{root:t,status:i,list:d,targetInput:r,btnLoad:o,btnRefresh:s}}();try{const e=await async function(t=2e4,e=window){const r=Date.now(),o=n(e);if(o)return o;for(;Date.now()-r<t;){await new Promise(t=>setTimeout(t,200));const t=n(e);if(t)return t}throw new Error("BCX API introuvable (same-origin).")}(2e4,window);t.status.textContent="BCX détecté. Récupération de toutes les règles…";let o=await s(e);o.length?t.status.textContent=`Règles détectées: ${o.length}.`:t.status.textContent="Impossible d’énumérer les règles (essaye ↻).",r(t.list,e,o),t.btnLoad.addEventListener("click",async()=>{const n=t.targetInput.value.trim();if(!n)return void r(t.list,e,o);const s=Number(n);if(Number.isFinite(s)){if(!e.sendQuery)return t.status.textContent="api.sendQuery indisponible (affichage local uniquement).",void r(t.list,e,o);try{await e.sendQuery("rules:pulse",{rules:o.slice(0,1)},s,3e3).catch(()=>{})}catch{}r(t.list,e,o),t.status.textContent=`États affichés (local). Requête envoyée à #${s} si supportée.`}else t.status.textContent="MemberNumber invalide."}),t.btnRefresh.addEventListener("click",async()=>{t.status.textContent="Récupération de toutes les règles…",o=await s(e),t.status.textContent=o.length?`Règles détectées: ${o.length}.`:"Aucune règle détectée.",r(t.list,e,o)})}catch(e){t.status.textContent=`BCX non détecté: ${e?.message??e}`}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a,{once:!0}):a()}();
